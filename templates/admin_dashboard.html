<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - Yard Services</title>
<script>
  atOptions = {
    'key' : 'd0fd3067ca9fd49b0435270473b5aef6',
    'format' : 'iframe',
    'height' : 60,
    'width' : 468,
    'params' : {}
  };
</script>
<script src="https://www.highperformanceformat.com/d0fd3067ca9fd49b0435270473b5aef6/invoke.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='themes/' + active_theme + '.css') }}">

  <!-- Dynamic Background (Image/GIF uploaded by admin) -->
  <style>
    body {
      {% if bg_image %}
        background-image: url("{{ url_for('static', filename='backgrounds/' + bg_image) }}");
        background-position: {{ bg_position }};
        background-size: {{ bg_size }};
        background-repeat: {{ bg_repeat }};
        background-attachment: {{ bg_attachment }};
      {% endif %}
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="{{ url_for('home') }}">üöÇ Yard Services Admin</a>
    </div>
  </nav>

  <div class="container mt-5">
    <h2 class="fw-bold mb-4">üìä Admin Dashboard</h2>

    <script>
  atOptions = {
    'key' : 'd0fd3067ca9fd49b0435270473b5aef6',
    'format' : 'iframe',
    'height' : 60,
    'width' : 468,
    'params' : {}
  };
</script>
<script src="https://www.highperformanceformat.com/d0fd3067ca9fd49b0435270473b5aef6/invoke.js"></script>
    <!-- üåÑ Background Upload Section -->
    <h4 class="mt-5">üåÑ Website Background Controls</h4>

    <!-- Upload Background -->
    <form method="POST" action="{{ url_for('upload_background') }}" enctype="multipart/form-data"
          class="card p-4 shadow-sm mb-4" style="max-width: 500px;">
      <label class="form-label fw-bold">Upload Background Image / GIF</label>
      <input type="file" name="file" class="form-control mb-3" required>
      <button class="btn btn-primary w-100">Upload Background</button>
    </form>

    <!-- Remove Background -->
    <form method="POST" action="{{ url_for('clear_background') }}"
          class="card p-3 shadow-sm mb-4" style="max-width: 500px;">
      <button class="btn btn-danger w-100">‚ùå Remove Background</button>
    </form>

    <!-- Background Settings -->
    <form method="POST" action="{{ url_for('update_background_settings') }}"
          class="card p-4 shadow-sm mb-4" style="max-width: 500px;">

      <label class="form-label fw-bold">Position</label>
      <select name="position" class="form-select mb-3">
        <option value="top center">Top</option>
        <option value="center center">Center</option>
        <option value="bottom center">Bottom</option>
      </select>

      <label class="form-label fw-bold">Size</label>
      <select name="size" class="form-select mb-3">
        <option value="cover">Cover</option>
        <option value="contain">Contain</option>
        <option value="auto">Auto</option>
      </select>

      <label class="form-label fw-bold">Repeat</label>
      <select name="repeat" class="form-select mb-3">
        <option value="no-repeat">No Repeat</option>
        <option value="repeat">Repeat</option>
      </select>

      <label class="form-label fw-bold">Attachment</label>
      <select name="attachment" class="form-select mb-3">
        <option value="fixed">Fixed</option>
        <option value="scroll">Scroll</option>
      </select>

      <button class="btn btn-success w-100">Save Background Settings</button>
    </form>

    <!-- Users Table -->
    <h4>üë• Registered Users</h4>
    <table class="table table-striped table-bordered shadow-sm">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Joined</th>
        </tr>
      </thead>
      <tbody>
        {% for u in users %}
        <tr>
          <td>{{ u[0] }}</td>
          <td>{{ u[1] }}</td>
          <td>{{ u[2] }}</td>
          <td>{{ u[3] }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Requests Table -->
    <h4 class="mt-5">üì¶ Service Requests</h4>
    <table class="table table-striped table-bordered shadow-sm">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>User ID</th>
          <th>Service</th>
          <th>Cost</th>
          <th>Address</th>
          <th>Phone</th>
          <th>Email</th>
          <th>Payment</th>
          <th>Note</th>
          <th>Date</th>
          <th>Time</th>
          <th>Token</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for r in requests %}
        <tr>
          <td>{{ r[0] }}</td>
          <td>{{ r[1] }}</td>
          <td>{{ r[2] }}</td>
          <td>${{ "%.2f"|format(r[3]) if r[3] else "" }}</td>
          <td>{{ r[4] }}</td>
          <td>{{ r[5] }}</td>
          <td>{{ r[6] }}</td>
          <td>{{ r[7] }}</td>
          <td>{{ r[8] }}</td>
          <td>{{ r[9] }}</td>
          <td>{{ r[10] }}</td>
          <td>{{ r[11] }}</td>
          <td>{{ r[12] }}</td>
          <td>
            <form method="POST" action="{{ url_for('delete_request', request_id=r[0]) }}"
                  onsubmit="return confirm('Delete this request?');">
              <input type="password" name="password" placeholder="Admin Pass" required class="form-control mb-2">
              <button type="submit" class="btn btn-danger btn-sm">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Services Management -->
    <h4 class="mt-5">üõ† Manage Services</h4>
    <form method="POST" action="{{ url_for('add_service') }}" class="card p-4 shadow-sm mb-4" style="max-width: 500px;">
      <div class="mb-3">
        <label for="name" class="form-label">Service Name</label>
        <input type="text" id="name" name="name" placeholder="Service Name" class="form-control" required>
      </div>
      <div class="mb-3">
        <label for="price" class="form-label">Price ($)</label>
        <input type="number" step="0.01" id="price" name="price" placeholder="Price" class="form-control" required>
      </div>
      <button type="submit" class="btn btn-primary w-100">‚ûï Add Service</button>
    </form>

    <table class="table table-striped table-bordered shadow-sm">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Price</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for s in services %}
        <tr>
          <td>{{ s[0] }}</td>
          <td>{{ s[1] }}</td>
          <td>${{ "%.2f"|format(s[2]) }}</td>
          <td class="d-flex gap-2">
            <form method="POST" action="{{ url_for('update_service', service_id=s[0]) }}" class="d-flex gap-2">
              <input type="text" name="name" value="{{ s[1] }}" class="form-control form-control-sm" required>
              <input type="number" step="0.01" name="price" value="{{ s[2] }}" class="form-control form-control-sm" required>
              <button type="submit" class="btn btn-warning btn-sm">Update</button>
            </form>
            <form method="POST" action="{{ url_for('delete_service', service_id=s[0]) }}"
                  onsubmit="return confirm('Delete this service?');">
              <button type="submit" class="btn btn-danger btn-sm">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Ratings Table -->
    <h4 class="mt-5">‚≠ê User Ratings & Feedback</h4>
    <table class="table table-striped table-bordered shadow-sm">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>User</th>
          <th>Rating</th>
          <th>Comment</th>
          <th>Submitted</th>
        </tr>
      </thead>
      <tbody>
        {% for r in ratings %}
        <tr>
          <td>{{ r[0] }}</td>
          <td>{{ r[1] }}</td>
          <td>{{ r[2] }}‚≠ê</td>
          <td>{{ r[3] }}</td>
          <td>{{ r[4] }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Promotions Management -->
    <h4 class="mt-5">üéÅ Promotions & Seasonal Offers</h4>
    <form method="POST" action="{{ url_for('add_promotion') }}" class="card p-4 shadow-sm mb-4" style="max-width: 500px;">
      <div class="mb-3">
        <label for="promo_name" class="form-label">Promotion Name</label>
        <input type="text" id="promo_name" name="name" placeholder="Winter Cleanup" class="form-control" required>
      </div>
      <div class="mb-3">
        <label for="promo_token" class="form-label">Token Code</label>
        <input type="text" id="promo_token" name="token" placeholder="WINTER30" class="form-control" required>
      </div>
      <div class="mb-3">
        <label for="promo_discount" class="form-label">Discount (%)</label>
        <input type="number" id="promo_discount" name="discount" placeholder="30" class="form-control" required>
      </div>
      <div class="mb-3">
        <label for="promo_expiry" class="form-label">Expiry Date</label>
        <input type="date" id="promo_expiry" name="expires_at" class="form-control" required>
      </div>
      <button type="submit" class="btn btn-success w-100">‚ûï Add Promotion</button>
    </form>

    <table class="table table-striped table-bordered shadow-sm">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Token</th>
          <th>Discount</th>
          <th>Active</th>
          <th>Expiry</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for p in promotions %}
        <tr>
          <td>{{ p[0] }}</td>
          <td>{{ p[1] }}</td>
          <td>{{ p[2] }}</td>
          <td>{{ p[3] }}%</td>
          <td>{{ 'Yes' if p[4] else 'No' }}</td>
          <td>{{ p[5] }}</td>
          <td>{{ p[6] }}</td>
          <td>
            <form method="POST" action="{{ url_for('delete_promotion', promo_id=p[0]) }}"
                  onsubmit="return confirm('Delete this promotion?');">
              <button type="submit" class="btn btn-danger btn-sm">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Seasonal Theme Controls -->
    <h4 class="mt-5">üé® Seasonal Theme Controls</h4>
    <form method="POST" action="{{ url_for('set_theme') }}" class="card p-3 shadow-sm" style="max-width: 500px;">
      <label class="form-label fw-bold">Select Theme</label>

      <select name="theme" class="form-select mb-3">
        <option value="none">No Theme</option>
        <option value="winter">‚ùÑÔ∏è Winter Snow</option>
        <option value="halloween">üéÉ Halloween</option>
        <option value="blackfriday">üõí Black Friday</option>
        <option value="summer">üåû Summer</option>
        <option value="fall">üçÅ Fall</option>
      </select>

      <button class="btn btn-primary w-100">Apply Theme</button>
    </form>

  </div> <!-- end .container -->

  <!-- Footer -->
  <footer class="bg-dark text-white text-center py-3 mt-5">
    <small>¬© 2025 Yard Services. Admin Panel</small>
  </footer>

</body>
</html>
